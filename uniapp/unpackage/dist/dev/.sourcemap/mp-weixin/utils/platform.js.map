{"version":3,"file":"platform.js","sources":["utils/platform.js"],"sourcesContent":["// 平台特定功能处理工具\nimport { getPlatform, checkPlatformSupport } from './config.js'\n\n// 平台适配的存储操作\nexport const storage = {\n\t// 设置存储\n\tset(key, value) {\n\t\ttry {\n\t\t\tconst data = typeof value === 'string' ? value : JSON.stringify(value);\n\t\t\tuni.setStorageSync(key, data);\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\tconsole.error('Storage set error:', error);\n\t\t\treturn false;\n\t\t}\n\t},\n\t\n\t// 获取存储\n\tget(key, defaultValue = null) {\n\t\ttry {\n\t\t\tconst data = uni.getStorageSync(key);\n\t\t\tif (!data) return defaultValue;\n\t\t\t\n\t\t\t// 尝试解析JSON，失败则返回原始字符串\n\t\t\ttry {\n\t\t\t\treturn JSON.parse(data);\n\t\t\t} catch {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Storage get error:', error);\n\t\t\treturn defaultValue;\n\t\t}\n\t},\n\t\n\t// 删除存储\n\tremove(key) {\n\t\ttry {\n\t\t\tuni.removeStorageSync(key);\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\tconsole.error('Storage remove error:', error);\n\t\t\treturn false;\n\t\t}\n\t},\n\t\n\t// 清空存储\n\tclear() {\n\t\ttry {\n\t\t\tuni.clearStorageSync();\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\tconsole.error('Storage clear error:', error);\n\t\t\treturn false;\n\t\t}\n\t}\n};\n\n// 平台适配的导航操作\nexport const navigation = {\n\t// 页面跳转\n\tnavigateTo(url, params = {}) {\n\t\tconst platform = getPlatform();\n\t\t\n\t\t// 构建完整URL\n\t\tlet fullUrl = url;\n\t\tif (Object.keys(params).length > 0) {\n\t\t\tconst queryString = Object.entries(params)\n\t\t\t\t.map(([key, value]) => `${key}=${encodeURIComponent(JSON.stringify(value))}`)\n\t\t\t\t.join('&');\n\t\t\tfullUrl += (url.includes('?') ? '&' : '?') + queryString;\n\t\t}\n\t\t\n\t\t// 平台特定处理\n\t\tswitch (platform) {\n\t\t\tcase 'mp-weixin':\n\t\t\t\t// 微信小程序路径长度限制\n\t\t\t\tif (fullUrl.length > 1000) {\n\t\t\t\t\tconsole.warn('微信小程序URL过长，可能导致跳转失败');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'h5':\n\t\t\t\t// H5环境可能需要特殊处理\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\tuni.navigateTo({ url: fullUrl });\n\t},\n\t\n\t// 返回上一页\n\tnavigateBack(delta = 1) {\n\t\tuni.navigateBack({ delta });\n\t},\n\t\n\t// 重定向\n\tredirectTo(url) {\n\t\tuni.redirectTo({ url });\n\t},\n\t\n\t// 切换Tab\n\tswitchTab(url) {\n\t\tuni.switchTab({ url });\n\t}\n};\n\n// 平台适配的提示操作\nexport const feedback = {\n\t// 显示提示\n\tshowToast(title, options = {}) {\n\t\tconst platform = getPlatform();\n\t\t\n\t\tconst config = {\n\t\t\ttitle,\n\t\t\ticon: options.icon || 'none',\n\t\t\tduration: options.duration || 2000,\n\t\t\t...options\n\t\t};\n\t\t\n\t\t// 平台特定调整\n\t\tswitch (platform) {\n\t\t\tcase 'mp-weixin':\n\t\t\t\t// 微信小程序图标限制\n\t\t\t\tif (!['success', 'loading', 'none'].includes(config.icon)) {\n\t\t\t\t\tconfig.icon = 'none';\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'mp-alipay':\n\t\t\t\t// 支付宝小程序特殊处理\n\t\t\t\tif (config.icon === 'error') {\n\t\t\t\t\tconfig.icon = 'none';\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\tuni.showToast(config);\n\t},\n\t\n\t// 显示加载中\n\tshowLoading(title = '加载中...') {\n\t\tuni.showLoading({ title });\n\t},\n\t\n\t// 隐藏加载中\n\thideLoading() {\n\t\tuni.hideLoading();\n\t},\n\t\n\t// 显示模态对话框\n\tshowModal(title, content, options = {}) {\n\t\treturn new Promise((resolve) => {\n\t\t\tuni.showModal({\n\t\t\t\ttitle,\n\t\t\t\tcontent,\n\t\t\t\tshowCancel: options.showCancel !== false,\n\t\t\t\tcancelText: options.cancelText || '取消',\n\t\t\t\tconfirmText: options.confirmText || '确定',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tresolve(res.confirm);\n\t\t\t\t},\n\t\t\t\tfail: () => {\n\t\t\t\t\tresolve(false);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n};\n\n// 平台适配的网络状态检查\nexport const network = {\n\t// 检查网络状态\n\tgetNetworkType() {\n\t\treturn new Promise((resolve) => {\n\t\t\tuni.getNetworkType({\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tresolve(res.networkType);\n\t\t\t\t},\n\t\t\t\tfail: () => {\n\t\t\t\t\tresolve('unknown');\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\t\n\t// 监听网络状态变化\n\tonNetworkStatusChange(callback) {\n\t\tuni.onNetworkStatusChange(callback);\n\t},\n\t\n\t// 检查是否有网络连接\n\tasync isConnected() {\n\t\tconst networkType = await this.getNetworkType();\n\t\treturn networkType !== 'none' && networkType !== 'unknown';\n\t}\n};\n\n// 平台适配的设备信息\nexport const device = {\n\t// 获取系统信息\n\tgetSystemInfo() {\n\t\treturn new Promise((resolve) => {\n\t\t\tuni.getSystemInfo({\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tresolve(res);\n\t\t\t\t},\n\t\t\t\tfail: () => {\n\t\t\t\t\tresolve({});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\t\n\t// 获取设备基础信息\n\tasync getDeviceInfo() {\n\t\tconst systemInfo = await this.getSystemInfo();\n\t\tconst platform = getPlatform();\n\t\t\n\t\treturn {\n\t\t\tplatform,\n\t\t\tsystem: systemInfo.system || 'unknown',\n\t\t\tversion: systemInfo.version || 'unknown',\n\t\t\tmodel: systemInfo.model || 'unknown',\n\t\t\tpixelRatio: systemInfo.pixelRatio || 1,\n\t\t\tscreenWidth: systemInfo.screenWidth || 0,\n\t\t\tscreenHeight: systemInfo.screenHeight || 0,\n\t\t\twindowWidth: systemInfo.windowWidth || 0,\n\t\t\twindowHeight: systemInfo.windowHeight || 0,\n\t\t\tstatusBarHeight: systemInfo.statusBarHeight || 0,\n\t\t\tsafeArea: systemInfo.safeArea || {},\n\t\t\tsafeAreaInsets: systemInfo.safeAreaInsets || {}\n\t\t};\n\t}\n};\n\n// 平台特性检查\nexport const features = {\n\t// 检查是否支持某个功能\n\tsupports(feature) {\n\t\treturn checkPlatformSupport(feature);\n\t},\n\t\n\t// 获取支持的功能列表\n\tgetSupportedFeatures() {\n\t\tconst features = ['http', 'https', 'localStorage', 'location', 'share', 'payment', 'camera'];\n\t\treturn features.filter(feature => this.supports(feature));\n\t},\n\t\n\t// 获取平台限制信息\n\tgetPlatformLimitations() {\n\t\tconst platform = getPlatform();\n\t\t\n\t\tconst limitations = {\n\t\t\t'mp-weixin': [\n\t\t\t\t'只支持HTTPS请求',\n\t\t\t\t'需要配置服务器域名白名单',\n\t\t\t\t'包体积限制2MB',\n\t\t\t\t'单个页面栈限制10层'\n\t\t\t],\n\t\t\t'mp-alipay': [\n\t\t\t\t'只支持HTTPS请求',\n\t\t\t\t'需要配置服务器域名白名单',\n\t\t\t\t'包体积限制2MB'\n\t\t\t],\n\t\t\t'h5': [\n\t\t\t\t'受CORS策略限制',\n\t\t\t\t'不支持某些原生API',\n\t\t\t\t'性能受浏览器影响'\n\t\t\t],\n\t\t\t'app-plus': [\n\t\t\t\t'需要原生插件支持某些功能',\n\t\t\t\t'打包体积较大'\n\t\t\t]\n\t\t};\n\t\t\n\t\treturn limitations[platform] || [];\n\t}\n};\n\n// 导出所有工具\nexport default {\n\tstorage,\n\tnavigation,\n\tfeedback,\n\tnetwork,\n\tdevice,\n\tfeatures,\n\tgetPlatform\n};"],"names":["uni","platform","getPlatform","checkPlatformSupport","features"],"mappings":"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"}