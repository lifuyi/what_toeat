<view class="container"><view class="header"><view class="header-content"><view class="greeting-section"><text class="emoji">✨</text><text class="greeting-text">{{greeting+"，"+meal+"吃什么？"}}</text><text class="emoji">🍽️</text></view><block wx:if="{{showTestButton}}"><view data-event-opts="{{[['tap',[['goToApiTest',['$event']]]]]}}" class="test-api-btn" bindtap="__e"><text class="test-text">🔧 API测试</text></view></block><text class="subtitle">调整你的口味偏好，获取个性化菜品推荐</text><view class="date-info"><text class="date-text">{{currentDate}}</text></view><view class="tags"><view class="tag tag-ai">🤖 AI智能推荐</view><view class="tag tag-realtime">⚡ 实时更新</view><view class="tag tag-personal">🎯 个性化定制</view></view></view></view><view class="preset-section"><text class="section-title">🎯 快速预设配置</text><view class="preset-row"><block wx:for="{{presets}}" wx:for-item="preset" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectPreset',['$0'],[[['presets','',index]]]]]]]}}" class="preset-icon-btn" bindtap="__e"><text class="preset-emoji">{{preset.emoji}}</text></view></block><view data-event-opts="{{[['tap',[['randomRecommend',['$event']]]]]}}" class="preset-icon-btn preset-random" bindtap="__e"><text class="preset-emoji">🎲</text></view></view></view><view class="search-section"><view class="search-card"><view class="search-header"><text class="search-emoji">🥬</text><text class="search-title">食材搜索</text></view><view class="search-row"><view class="search-input-wrapper"><input class="search-input" placeholder="输入您有的食材..." data-event-opts="{{[['confirm',[['handleSearch',['$event']]]],['input',[['__set_model',['','searchTerm','$event',[]]]]]]}}" value="{{searchTerm}}" bindconfirm="__e" bindinput="__e"/><block wx:if="{{searchTerm}}"><view data-event-opts="{{[['tap',[['clearSearch',['$event']]]]]}}" class="clear-btn" bindtap="__e">✕</view></block></view><button class="search-btn" disabled="{{!$root.g0}}" data-event-opts="{{[['tap',[['handleSearch',['$event']]]]]}}" bindtap="__e"><block wx:if="{{isSearching}}"><text>🔍</text></block><block wx:else><text>🔍</text></block></button></view><text class="search-tip">💡 输入您现有的食材，我们为您推荐相关菜品</text></view></view><view class="radar-section"><text class="section-title">📊 口味雷达图</text><view class="radar-container"><canvas class="radar-canvas" canvas-id="radarChart" data-event-opts="{{[['touchstart',[['onRadarTouch',['$event']]]]]}}" bindtouchstart="__e"></canvas><view class="radar-legend"><block wx:for="{{$root.l0}}" wx:for-item="pref" wx:for-index="key" wx:key="key"><view class="legend-item"><view class="legend-color" style="{{'background-color:'+(pref.m0)+';'}}"></view><text class="legend-label">{{pref.m1}}</text></view></block></view></view></view><view class="preferences-section"><text class="section-title">🎛️ 口味偏好调节</text><view class="preference-controls"><block wx:for="{{$root.l1}}" wx:for-item="pref" wx:for-index="key" wx:key="key"><view class="preference-item"><view class="preference-header"><text class="preference-label">{{pref.m2}}</text><text class="preference-value">{{pref.$orig}}</text></view><slider class="compact-slider" value="{{pref.$orig}}" min="{{1}}" max="{{10}}" step="{{1}}" activeColor="#6366f1" backgroundColor="#e2e8f0" data-event-opts="{{[['change',[['updatePreference',[key,'$event']]]]]}}" bindchange="__e"></slider></view></block></view></view><view class="recommendations-section"><text class="section-title">🍳 为您推荐</text><block wx:if="{{loading}}"><view class="loading"><text>正在为您推荐美食...</text></view></block><block wx:else><view class="dish-grid"><block wx:for="{{$root.l3}}" wx:for-item="dish" wx:for-index="index" wx:key="id"><view data-event-opts="{{[['tap',[['viewDishDetail',['$0'],[[['recommendedDishes','id',dish.$orig.id]]]]]]]}}" class="dish-card" bindtap="__e"><view class="dish-header"><text class="dish-name">{{dish.$orig.name}}</text><block wx:if="{{dish.$orig.matchScore}}"><view class="match-score"><text class="score-text">{{dish.g1+"%匹配"}}</text></view></block></view><text class="dish-description">{{dish.$orig.description}}</text><view class="dish-meta"><text class="meta-item">{{"⏱️ "+dish.$orig.cookingTime}}</text><text class="meta-item">{{"📊 "+dish.$orig.difficulty}}</text></view><view class="dish-tags"><block wx:for="{{dish.l2}}" wx:for-item="tag" wx:for-index="__i0__" wx:key="*this"><text class="dish-tag">{{tag}}</text></block></view></view></block></view></block></view></view>